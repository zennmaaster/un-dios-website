---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const posts = await getCollection('blog');
const sorted = posts.sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime());

const categoryColors: Record<string, string> = {
  fiction: 'bg-violet-500/20 text-violet-300 border-violet-500/30',
  essay: 'bg-emerald-500/20 text-emerald-300 border-emerald-500/30',
  screenplay: 'bg-amber-500/20 text-amber-300 border-amber-500/30',
  review: 'bg-blue-500/20 text-blue-300 border-blue-500/30',
};

const categories = ['all', 'fiction', 'essay', 'screenplay', 'review'];
---

<Layout title="Archive - Arvind Chandrashekar" description="Fiction, essays, and abandoned manuscripts from a previous life. Written between 2007-2020 under the pen name Athul DeMarco.">

  <!-- Header -->
  <section class="max-w-5xl mx-auto px-6 pt-20 pb-8">
    <h1 class="text-4xl md:text-5xl font-bold mb-4 tracking-tight">Archive</h1>
    <p class="text-xl text-zinc-400 leading-relaxed max-w-3xl">
      Fiction, essays, and abandoned manuscripts from a previous life. Written between 2007&ndash;2020 under the pen name <span class="text-zinc-200 font-medium">Athul DeMarco</span>.
    </p>
  </section>

  <!-- Author Bio -->
  <section class="max-w-5xl mx-auto px-6 pb-12">
    <div class="bg-zinc-900/60 border border-zinc-800 rounded-2xl p-8 backdrop-blur-sm">
      <div class="flex items-start gap-4">
        <div class="shrink-0 w-10 h-10 rounded-full bg-violet-500/20 border border-violet-500/30 flex items-center justify-center text-violet-300 text-sm font-bold">
          AD
        </div>
        <div>
          <p class="text-sm text-zinc-500 mb-2 font-medium tracking-wide uppercase">About the Author</p>
          <p class="text-zinc-400 leading-relaxed italic">
            "Athul DeMarco resides in Bangalore. For now. He is a travelling design researcher. And when he is not traveling, he is seated, in his boxers, writing on his laptop or shouting at the television. He took a break from a cushy job, gave up a company expense account in 2009, and now spends his time writing stories instead of making PowerPoint presentations. He is delusional when it comes to cricket and believes that Ajit Agarkar is the greatest player of all time. He also believes that Sherlock Holmes truly exists."
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Category Filters -->
  <section class="max-w-5xl mx-auto px-6 pb-8">
    <div class="flex flex-wrap gap-2" id="filters">
      {categories.map((cat) => (
        <button
          data-filter={cat}
          class:list={[
            "px-4 py-2 rounded-lg text-sm font-medium transition border cursor-pointer",
            cat === 'all'
              ? "bg-zinc-100 text-zinc-900 border-zinc-100"
              : "bg-zinc-900 text-zinc-400 border-zinc-800 hover:border-zinc-600 hover:text-zinc-200"
          ]}
        >
          {cat === 'all' ? 'All' : cat.charAt(0).toUpperCase() + cat.slice(1)}
        </button>
      ))}
    </div>
  </section>

  <!-- Content Grid -->
  <section class="max-w-5xl mx-auto px-6 pb-20">
    <div class="grid gap-6" id="posts-grid">
      {sorted.map((post) => (
        <a href={`/archive/${post.id}`}
           class="group block bg-zinc-900/40 border border-zinc-800 rounded-2xl p-6 hover:border-zinc-600 hover:bg-zinc-900/60 transition-all backdrop-blur-sm"
           data-category={post.data.category}>
          <div class="flex flex-col md:flex-row md:items-start md:justify-between gap-4">
            <div class="flex-1 min-w-0">
              <div class="flex flex-wrap items-center gap-3 mb-3">
                <span class:list={["text-xs px-2.5 py-1 rounded-full border font-medium", categoryColors[post.data.category] || 'bg-zinc-800 text-zinc-400 border-zinc-700']}>
                  {post.data.category}
                </span>
                <span class="text-xs text-zinc-600">
                  {new Date(post.data.date).toLocaleDateString('en-US', { year: 'numeric', month: 'short' })}
                </span>
                {post.data.source === 'manuscript' && (
                  <span class="text-xs px-2 py-0.5 rounded-full bg-zinc-800 text-zinc-500 border border-zinc-700">
                    Previously Unpublished
                  </span>
                )}
                {post.data.readTime && (
                  <span class="text-xs text-zinc-600">{post.data.readTime}</span>
                )}
              </div>
              <h2 class="text-xl font-bold mb-2 group-hover:text-zinc-100 transition">{post.data.title}</h2>
              <p class="text-zinc-400 text-sm leading-relaxed mb-3">{post.data.description}</p>
              <p class="text-zinc-500 text-xs leading-relaxed">
                <span class="text-zinc-600 font-medium">Genre:</span> {post.data.genre}
              </p>
              <p class="text-zinc-500 text-xs leading-relaxed italic mt-1">{post.data.audience}</p>
            </div>
            <div class="shrink-0 text-zinc-700 group-hover:text-zinc-400 transition">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
              </svg>
            </div>
          </div>
        </a>
      ))}
    </div>
  </section>

  <!-- Footer Note -->
  <section class="max-w-5xl mx-auto px-6 pb-16 text-center">
    <p class="text-zinc-600 text-sm italic">
      Originally published on Little Black Book (<a href="https://whabook.blogspot.com" target="_blank" rel="noopener" class="hover:text-zinc-400 underline">whabook.blogspot.com</a>). Manuscripts previously unreleased.
    </p>
  </section>

  <!-- Filter Script -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const buttons = document.querySelectorAll('#filters button');
      const posts = document.querySelectorAll('#posts-grid a');

      buttons.forEach(btn => {
        btn.addEventListener('click', () => {
          const filter = btn.getAttribute('data-filter');

          // Update button styles
          buttons.forEach(b => {
            b.className = 'px-4 py-2 rounded-lg text-sm font-medium transition border cursor-pointer bg-zinc-900 text-zinc-400 border-zinc-800 hover:border-zinc-600 hover:text-zinc-200';
          });
          btn.className = 'px-4 py-2 rounded-lg text-sm font-medium transition border cursor-pointer bg-zinc-100 text-zinc-900 border-zinc-100';

          // Filter posts
          posts.forEach(post => {
            const cat = post.getAttribute('data-category');
            if (filter === 'all' || cat === filter) {
              (post as HTMLElement).style.display = '';
            } else {
              (post as HTMLElement).style.display = 'none';
            }
          });
        });
      });
    });
  </script>

</Layout>
